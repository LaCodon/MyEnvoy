<?php if ($_SERVER['REQUEST_URI'] === '/de'): ?>
<!--
WWWWWWWWWW@@WWWWWWWWWWWW@@WW@WWWWWWWWWWWWWWWWWWW@@@@@@WW@@@@@@@@@WWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWW@WW@WWWWWWWWWWWWWWWWWWWWW@@@@@@WW@@@@@@@@@WWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWWW@@WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@@@@WW@@@@@@@@@WWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWW@WWWWW@@WWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@@@@@@@@@WW@@@@@@@WWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWWWW@WWWWWWWWWWWWW@@@@@@@@@@@@@WWWWW@@@@WWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWW@WWWWWWWWWWWW@@@@@W@W@@@@WWWWWWWWWWWW@WWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@@@@WW@W@WWWWWWWWWWWWWWWWWWWWWWWW@@@@@@@@@@@@@@@@
WWWW@WWWWWWWWWWWWWWWWWWWWWWW@WWWWWWWWW@@@@WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@W@@@W@WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@@@@@W@WWWWWWWWWWWWWWW@WWW@WWWWWWWW@WWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@@@@@WWWWWWWWWWWWWWWW@@WWWWWWWWWWW@WWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWWWW@W@@W@@@@W@WWWWWWWWWWWWWWWW@@@@WWWWWWWWWWWWWW@@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW@@W@@@@W@@WWWWWWWWWWWW@@@@@#@@@WWWWWWWWWWWWW@@@@@@@@@@@@@@@
WWWW@WWWWWWWWWWWWWWWWWWWWWWWW@@@WW@@@@W@W@WWWWWWWWWWW@@@@@@#@@@WWWWWWWWWWWW@@@@@@@@@@@@@@@
WWWW@WWWWWWWWWWWWWWWWWWWWWW@@@@@@WW@@@W@@@WWWWWWWWWWW@W@WWW@@@@WWWWWWWWWWWW@@@@@@@@@@@@@@@
WWW@W@WWWWWW@WWWWWWWWWWWWWW@@@@@@@WW@@@@@@@@WWWWWWWWWWW@@@WW@@@@@WWWWWWWWWW@@@@@@@@@@@@@@@
WWWWW@WWWWWWWWWWWWWWWWWWWWW@@@@@@@@@@@@W@@@@@@@@WWWWWWWWW@@@WW@@@@WWWWWWWWW@@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWWWWWW@@@@@@@@@@@@@@@@@@@@WWWWWWWWWW@#@WW@@@WWWWWWWWW@@@@@@@@@@@@@@@
WWWWWWWWW@W@WWWWWWWWWWWWWWW@@@@@@@@@@@@@@@@@@@@@@WWWWWWWWWW@@@W@WWWWWWWWWWW@@@@@@@@@@@@@@@
WWWWWWWW@@@@@@@WWWWWWWWWWWWWWW@@@@@@@@@@@@@@@@@@@WWWWWWWWWWWW@@WWWWWWWWWWWW@@@@@@@@@@@@@@@
WWWWWWW@@@@@@@@@WWWWWWWWWWWWW@@@@@@@@@@@@@@@@@@@@@@@@@@WWWWWWW@@WWWWWWWWWWW@@@@@@@@@@@@@@@
WWWWWWW@@@WW@@@@WWWWWWWWWWW@@@@@@@@@@@@@######@@@@@@@@@@@WWWWWW@WWWWWWWWWWW@@@@@@@@@@@@@@@
WWWWWWWWWWWWWW@@WWWWWWWWWW@@@@@@@@@@@@@#########@####@@@@@WWWWWWWWWWWWWWWWW@@@@@@@@@@@@@@@
WWW@@WWWWWWWWWWWWWWWWWWW@@@@@@@@@@@###################@@@@@WWWWWWWWWWWWWWWWW@@@@@@@@@@@@@@
WWW@@WWWWWWWWWWWWWWWWWWW@@@@@@@@@###############*#######@@@@@WWWWWWWWWWWWWWW@@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWW@@@@@@@@@#########**********#######@@@@WWWWWWWWWWWWWWW@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWW@@@@@@@@@########****************###@@@@WWWWWWWWWWWWWW@@@@@@@@@@@@@
WWWWW@WWWWWWWWWWWWWWWW@@@@@@@@@########*****************####@@@WWWWWWWWWWWWWW@@@@@@@@@@@@@
WWW@@@WWWWWWWWWWWWWWWWW@@@@@@@#########*****************#####@@@WWWWWWWWWWWWW@@@@@@@@@@@@@
WW@@@@WWWWWWWWWWWWWWWWW@@@@@@@##########****************#####@@@WWWWWWWWWWWWW@@@@@@@@@@@@@
@@@@@@WWW@@@WWWWWWWWWWW@WW@@@@#########*****************######@@@WWWWWWWWWWWW@@@@@@@@@@@@@
@@@@@@@W@WW@WWWWWWWWWW@@W@@@@@#########*****************######@@@WWWWWW@WWWWW@@@@@@@@@@@@@
@@@@@@@@@WW@WWWWWWWWWWWW@@@@@#########*******************######@@@WWWW@@WWWWW@@@@@@@@@@@@@
@@@@@@@@@@W@WWWWWWWWWWW@W@@@@#########*******************######@@@WWWWW@WWWWW@@@@@@@@@@@@@
WWWWWWW@@@@WWWWWWWWWWWWWW@@@#########*********************######@@@WWWWWWWWWW@@@@@@@@@@@@@
WWWWWWWWW@@@@WWWWWWWW@W@@@@@########*********************########@@WWWWW@WWWWW@@@@@@@@@@@@
WWWWWWWWWWW@WWWWWW@WWW@@@@@@######************************########@WWW@WWWWWW@@@@@@@@@@@@W
WWWWWWWWWWWWWWWWWWWWWW@W@@@@######************************########@WWW@@W@WWW@@@@@@@@@@@@W
WWWWWWWWWWWWWWWWWWWWWW@W@@@@#####**************************######@@WWW@@WWWWW@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWW@WW@@@@#####****************************####@@WWW@@@WWWW@@@@@@@@@@@@@
WWWWWWWWWWWWWWWWWWWWWWWW@@@@@@@######************************####@@WWW@@WWWWW@@@@@@@@@@@@@
W@@W@@@@@@@@WWWWWWWWW@W@@@@@@@@@@@@@@@#####*******************###@@WW@@@@WWWW@@@@@@@@@@@@@
WW@@@@@@@@@@WWWWWWWWWWW@@@@@####@@@W@W@@@####****###***#******###@@WWW@@@WWW@@@@@@@@@@@@@@
W@@@@@WWW@W@WWWWWWWWW@@@@@@#######@@@@@@@@###***#################@@@WW@@@@W@@@@@@@@@@@@@@@
@@@@@@@@@@W@WWWWW@WWW@@@@@@###@@###@@@@@@@###***##@@@@@@@@@@@@#@#@@@W@W@@@WW@@@@@@@@@@@@@@
@@@@@@WW@@W@WWWWWWWW@@@@@@@@@@@WWWWW@@#@@@###**###@@@@@WWWW@@@@@@@@@WWW@@@WW@@@@@@@@@@@@@@
@@@@@@@@@@WWWWWWWWWW@@@@@@@@@WW@@WW@#@@#@@###***##@@@WWWWW@#####@@@@@W@@@@@W@@@@@@@@@@@@@@
@@@@@@@@@@WWWWWWWWWW@@@@@@@@@@@#@@@@##@@#@###***#@@@@@@WWWW@@####@@@@@@W@@@W@@@@@@@@@@@@@@
@@@@@@@@@@@WWWWWWWWW@W@@###@@@##@@@@**+*#####***#@##@#@@#@@@W@@#@@@W@WWW@@WW@@@@@@@@@@@@@@
@@@@@@@@@@@W@WWWWWW@@W@@#####@#@#######**####***#####*@@W@@#@W@@@@@W@WW@WW@WW@@@@@@@@@@@@#
@@@@@@@@@@@WWWWWWWW@@W@######################**####*###@@@##@@@@@@@W@@WWWW@@W@@@@@@#######
@@@@@@@@@@WWWWWWWW@@@@@@#############*######***########*#####@@@#@@@W@WWWWW@@W@@@#########
@@@@@@@#@@@@WWWW@@@@@@@@####**********######***####**############@@WW@@WWWW@WW@@##########
@@@@@@@#@@@@WWW@@W@@@@@@###************#####***#####**###########@@@WWW@WWWWWW@@@#########
@@@@@@@@@@@@WWW@@@@@@@@@####**********######***#####***###########@@WWWW@WWWWW@@@@@@#@##@#
@@@@@@##@@@@@@@@@@@@@@@@####*********#######***#####********######@@WW@WW@W@@@@@##########
@@@@@@##@@@@@@@W@@@@@@@@####***********#####***#####**********####@@WWW@W@WWW#@###########
##@@@@##@@@@@@@@@@@@@@@#####***********####*****####**********###@@@WWWWWWWW@@@@##########
###@@@#@@@@@@@@#@#@@@@@#####**********#####*****###***********###@@@WWWWWW@W@@@###########
####@@@@@@@@@@@@#@@@@@#@###**********#####******###***********###@W@WWW@WW@@@@############
####@##@@@@@@@@@@#@@@@#@###*********#######******###*********####@@@@@WW@@@@@@############
######@@#@@@@@@@@@@@###@####*******#########****####*********####@@@@@@@@@@@##############
**#######@@@@@@@@@@@@##@####******####@@@###########*********####@@@@@@#*@@###############
*+######@@@@@@@@@@@@@@#@#####*****#*##@@W@@#####@###*********###@@@W@@@*+@@###############
**##*#@@@@@@@@@@@#@@@@#######***###*####@@@@##@@@@@#*********###@@WWW@@##@@##*############
++#**##@@@@@@@@@@##@@@#######***##########@@@@@@@###*********###@@WW@W@*:@@###############
++##*###@@@@@@@@@@@############******#######@#####**********####@WW@@@@#.@@##############@
*+#***###@@@@@@@@@#@@###########**######************###****#######@#@@@#.@@#############@@
++****######@@@@@@@@#########*############********#*##############@#@@@#.@@##############@
++++++*********######*#######***##@@@#@@############################@@@#.@@##***#########@
++++++*****************######***########@@@@###@@@##@@########@#####@@@#,@@##**##########@
++++++******************#####***#########*########@@###**###########@@@#,@@##****##*#####@
++++++******************#####******######******#########*#####*#####@@@@.@@##*****#######@
++++++******************######**##########***########*#***####*#####@@@@.@@##*****##**###@
*****+*******************###########################**#*#####*#*####@@@@.@@##***********#@
*************************#############################**######*#*###@@@@.#@##***********#@
**************************###########***####################*****###@@@@:#@@#***********##
**************************##########*********##****##########****###@@@@:#@@#************#
**************************#@########***************########*####***#@@@@:#@@#************#
**************************#@#########**************########*#####**#@@@@+#@@#************#
***********************####@@########*************###################@@@+#@@#*************
*********************######@@@@######************#######*############@@@+#@@#****########@
******************#########@@@@@######***********#######*############@@@*#@@*****#@#@@@@@@
***************############@@@@@@######*********#####@@##############@@@*#@@*#***#####@@##
***************############@@@@@@@@########****#####@@@##############@@@*#@@*#***#########
**************#############@###@@@@@################@################@@@#*@@##***#########
**************############@@####@@@@@@##########################*#**#@@@#*@@*#*##@@@@@@WWW
****################@@@@@#@######@@@@@#################@@@######***#@WWWWWWWWWWWWWWWWWWWWW
#######@@@@@@@@@@@@@@@@@@@##########@@@@@@@@@@@#########@@@#@@@WWWWWWWWWWWWWWWWWWWWWWWWWWW
@@@@@@@@@@@@@@@@@@@@@@@@@@###########@@@@@@@@@##########@#WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW
********################@@#############@#@@@@##############@*#@WWWWWWWWWWWWWWWWWWWWWWWWWWW
**********############@#@###################################++*+#WWWWWWWWWWWWWWWWWWWWWWWWW
*********############@############################**#######*:+++*#WWWW@WW@@WWWWWWWWWWWWWWW
-->
<?php endif; ?>
<?php
require '../../Famework/Famework.php';
require '../application/autoloader.php';

use Famework\Famework;
use Famework\Config\Famework_Config;
use Famework\Registry\Famework_Registry;
use Famework\Request\Famework_Request;
use Famework\Session\Famework_Session;

define('APPLICATION_PATH', __DIR__ . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR . 'application' . DIRECTORY_SEPARATOR);
define('HTTP_ROOT', str_replace('//', '/', str_replace(basename(__FILE__), '', $_SERVER['PHP_SELF']) . '/'));
define('VIEW_PATH', APPLICATION_PATH . 'view');

$config = new Famework_Config(APPLICATION_PATH . 'config' . DIRECTORY_SEPARATOR . 'config.ini');
$routes = new Famework_Config(APPLICATION_PATH . 'config' . DIRECTORY_SEPARATOR . 'routes.ini');

if ($config->getValue('myenvoy', 'env') === 'dev') {
    Famework_Registry::setEnv(Famework::ENV_DEV);
    error_reporting(E_ALL | E_STRICT);
} else {
    error_reporting(0);
}

$famework = new Famework($config, $routes);

require '../application/globalfunctions.php';

$famework->handleRequest();

$lang = $famework->getRequestParam('lang');
if ($lang !== NULL) {
    if (isset(getLangs()[$lang])) {
        define('APPLICATION_LANG', $lang);
    } else {
        // unavailable language --> 404 Error
        $famework->truncateRequest();
    }
} else {
    // check if page is found
    if ($famework->getController() !== NULL) {
        $default = $config->getValue('myenvoy', 'default_lang');
        $default = ($default === NULL ? 'en' : $default);
        if ($famework->getController() !== 'FederationController') {
            Famework_Request::redirect('/' . $default . '/', Famework_Request::CODE_TEMPORARYREDIRECT);
        } else {
            // no language for federation controller required
            define('APPLICATION_LANG', $default);
        }
    }
}

if ($config->getValue('myenvoy', 'support_https') == 1) {
    define('APPLICATION_HTTPS', TRUE);
} else {
    define('APPLICATION_HTTPS', FALSE);
}

Famework_Session::start(APPLICATION_HTTPS);
Famework_Registry::set('\famework_config', $config);
Famework_Registry::set('\famework_sys', $famework);

Log::init();

Errorhandler::registerDefaultHandler();

$famework->loadController();


